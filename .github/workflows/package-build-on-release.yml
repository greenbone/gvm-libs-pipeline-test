name: Trigger package build on release
on:
  release:
    types: [released]

permissions:
  contents: read
  packages: write
  id-token: write
  pull-requests: write

jobs:
  call_packaging_workflow:
    name: Call Packaging workflow
    runs-on: "ubuntu-latest"   
    steps:
      - name: Extract version
        shell: bash
        run: |
          # We can get the version here either from the tag or the name of the release entity in the 
          # webhook data of the triggering event here... both are not the plain version that we need.
          # So we extract the version to hand it over to the packaging process.                   
          released_version="$(echo "${{ github.event.release.name }}" | cut -d\  -f2)          
          echo RELEASED_VERSION="${released_version}" >> "$GITHUB_ENV"
      - name: Trigger development-packaging workflow
        uses: greenbone/actions/trigger-workflow@487dab5354ace3dd575c8cf100a3e522c1dd3a79
        with:
          token: ${{ secrets.GREENBONE_BOT_TOKEN }}
          repository: "greenbone/gea-pipeline"
          ref: "DEVOPS-1734_create_the_workflows"
          workflow: development-packaging.yml
          inputs: '{"upstream-version": "${{ env.RELEASED_VERSION }}", "component-repo-name-to-package": "${{ github.repository }}"}'
          wait-for-completion-timeout: 10000
